import"./performance-B58A-5gr.js";function Ye(r){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return r.forEach((t,s)=>{const n=`${t.link}-${s}`;e.articles.set(n,t),F(t.title).forEach(i=>{e.titleIndex.has(i)||e.titleIndex.set(i,[]),e.titleIndex.get(i).push(n)}),t.description&&F(t.description).forEach(h=>{e.contentIndex.has(h)||e.contentIndex.set(h,[]),e.contentIndex.get(h).push(n)}),t.categories&&t.categories.forEach(i=>{F(i).forEach(c=>{e.categoryIndex.has(c)||e.categoryIndex.set(c,[]),e.categoryIndex.get(c).push(n)})}),F(t.sourceTitle).forEach(i=>{e.sourceIndex.has(i)||e.sourceIndex.set(i,[]),e.sourceIndex.get(i).push(n)})}),e}function F(r){return r.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function Ze(r,e,t={}){const{includeTitle:s=!0,includeContent:n=!0,includeCategories:o=!0,includeSource:a=!0,fuzzyThreshold:i=.6}=t;if(!e.trim())return[];const h=F(e),c=new Map;h.forEach(f=>{s&&D(r.titleIndex,f,i,c,"title",3),n&&D(r.contentIndex,f,i,c,"content",1),o&&D(r.categoryIndex,f,i,c,"category",2),a&&D(r.sourceIndex,f,i,c,"source",1.5)});const m=[];return c.forEach((f,S)=>{const E=r.articles.get(S);E&&m.push({article:E,score:f.score,matchedFields:Array.from(f.matchedFields)})}),m.sort((f,S)=>S.score-f.score)}function D(r,e,t,s,n,o){r.forEach((a,i)=>{const h=me(e,i);if(h>=t){const c=h*o;a.forEach(m=>{s.has(m)||s.set(m,{score:0,matchedFields:new Set});const f=s.get(m);f.score+=c,f.matchedFields.add(n)})}})}function me(r,e){if(r===e)return 1;if(r.includes(e)||e.includes(r))return .9;const t=Math.max(r.length,e.length);return t===0?1:1-fe(r,e)/t}function fe(r,e){const t=Array(e.length+1).fill(null).map(()=>Array(r.length+1).fill(null));for(let s=0;s<=r.length;s++)t[0][s]=s;for(let s=0;s<=e.length;s++)t[s][0]=s;for(let s=1;s<=e.length;s++)for(let n=1;n<=r.length;n++){const o=r[n-1]===e[s-1]?0:1;t[s][n]=Math.min(t[s][n-1]+1,t[s-1][n]+1,t[s-1][n-1]+o)}return t[e.length][r.length]}function Qe(r,e){if(!e.trim())return r;const t=e.trim().split(/\s+/);let s=r;return t.forEach(n=>{const o=ge(n),a=new RegExp(`(${o})`,"gi");s=s.replace(a,"<mark>$1</mark>")}),s}function ge(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const J={DEBUG:0,INFO:1,WARN:2,ERROR:3},pe=r=>({level:"WARN",enableContextInjection:!0,enableCorrelationIds:!0,maxLogEntries:1e3,environment:r,transports:[{type:"console",enabled:!0,level:"WARN"},{type:"localStorage",enabled:!1,level:"INFO",batchSize:50,flushInterval:3e4},{type:"remote",enabled:!1,level:"WARN",batchSize:100,flushInterval:6e4,endpoint:"/api/logs"}]}),q=r=>({name:r.name,message:r.message,stack:r.stack,cause:r.cause?q(r.cause):void 0}),T=(r,e)=>J[r]>=J[e],K=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,ye=r=>{const e=new Date(r.timestamp).toISOString(),t=r.context.component?`[${r.context.component}]`:"",s=r.correlationId?`(${r.correlationId})`:"";return`${e} ${r.level} ${t}${s} ${r.message}`};class we{constructor(e){this.config=e}configure(e){this.config=e}async send(e){if(!this.config.enabled||!T(e.level,this.config.level))return;const t=ye(e),s={...e.context,error:e.error};switch(e.level){case"DEBUG":console.debug(t,s);break;case"INFO":console.info(t,s);break;case"WARN":console.warn(t,s);break;case"ERROR":console.error(t,s);break}}async batch(e){for(const t of e)await this.send(t)}async flush(){}}class be{constructor(e){this.buffer=[],this.storageKey="app-logs",this.config=e,this.startFlushTimer()}configure(e){this.config=e,this.startFlushTimer()}async send(e){!this.config.enabled||!T(e.level,this.config.level)||(this.buffer.push(e),this.buffer.length>=(this.config.batchSize||50)&&await this.flush())}async batch(e){const t=e.filter(s=>this.config.enabled&&T(s.level,this.config.level));this.buffer.push(...t),this.buffer.length>=(this.config.batchSize||50)&&await this.flush()}async flush(){if(this.buffer.length!==0)try{const n=[...this.getStoredLogs(),...this.buffer].slice(-1e3);localStorage.setItem(this.storageKey,JSON.stringify(n)),this.buffer=[]}catch(e){console.error("Failed to store logs in localStorage:",e)}}getStoredLogs(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch{return[]}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.config.flushInterval&&(this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval))}}class Se{constructor(e){this.buffer=[],this.config=e,this.startFlushTimer()}configure(e){this.config=e,this.startFlushTimer()}async send(e){!this.config.enabled||!T(e.level,this.config.level)||(this.buffer.push(e),this.buffer.length>=(this.config.batchSize||100)&&await this.flush())}async batch(e){const t=e.filter(s=>this.config.enabled&&T(s.level,this.config.level));this.buffer.push(...t),this.buffer.length>=(this.config.batchSize||100)&&await this.flush()}async flush(){if(this.buffer.length===0||!this.config.endpoint)return;const e=[...this.buffer];this.buffer=[];try{const t=await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify({logs:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(t){console.error("Failed to send logs to remote endpoint:",t),this.buffer.unshift(...e)}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.config.flushInterval&&(this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval))}}class Ee{constructor(e){this.transports=[],this.globalContext={},this.config=e,this.sessionId=K(),this.initializeTransports(),this.initializeGlobalContext()}initializeTransports(){this.transports=this.config.transports.map(e=>{switch(e.type){case"console":return new we(e);case"localStorage":return new be(e);case"remote":return new Se(e);default:throw new Error(`Unknown transport type: ${e.type}`)}})}initializeGlobalContext(){this.config.enableContextInjection&&(this.globalContext={sessionId:this.sessionId,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0,timestamp:Date.now()})}setContext(e){this.globalContext={...this.globalContext,...e}}getContext(){return{...this.globalContext}}debug(e,t){this.log("DEBUG",e,void 0,t)}info(e,t){this.log("INFO",e,void 0,t)}warn(e,t){this.log("WARN",e,void 0,t)}error(e,t,s){this.log("ERROR",e,t,s)}log(e,t,s,n){if(!T(e,this.config.level))return;const o={level:e,message:t,timestamp:Date.now(),context:{...this.globalContext,...n,url:typeof window<"u"?window.location.href:this.globalContext.url},error:s?q(s):void 0,correlationId:this.config.enableCorrelationIds?K():void 0};this.transports.forEach(a=>{a.send(o).catch(i=>{console.error("Transport failed to send log:",i)})})}async flush(){await Promise.all(this.transports.map(e=>e.flush()))}}let I=null;const ve=r=>{const s={...pe("production"),...r};return I=new Ee(s),I},w=()=>(I||(I=ve()),I),u={debug:(r,e)=>w().debug(r,e),info:(r,e)=>w().info(r,e),warn:(r,e)=>w().warn(r,e),error:(r,e,t)=>w().error(r,e,t),setContext:r=>w().setContext(r),getContext:()=>w().getContext(),flush:()=>w().flush()},et=r=>{const e=w();return{debug:(t,s)=>e.debug(t,{...s,component:r}),info:(t,s)=>e.info(t,{...s,component:r}),warn:(t,s)=>e.warn(t,{...s,component:r}),error:(t,s,n)=>e.error(t,s,{...n,component:r}),setContext:t=>e.setContext(t),getContext:()=>e.getContext()}},xe="https://api.open-meteo.com/v1/forecast",Te="https://geocoding-api.open-meteo.com/v1/search";async function tt(r){u.info("Fetching coordinates for city",{component:"weatherService",additionalData:{cityName:r}});const e=new URLSearchParams({name:r,count:"1",language:"en",format:"json"}),t=await fetch(`${Te}?${e.toString()}`);if(!t.ok){const o=new Error("Failed to fetch geocoding data");throw u.error("Geocoding API request failed",o,{component:"weatherService",additionalData:{cityName:r,status:t.status,statusText:t.statusText}}),o}const s=await t.json();if(!s.results||s.results.length===0)return u.warn("City not found in geocoding results",{component:"weatherService",additionalData:{cityName:r,resultsCount:s.results?.length||0}}),null;const n=s.results[0];return u.debug("Successfully retrieved city coordinates",{component:"weatherService",additionalData:{cityName:r,foundCity:n.name,latitude:n.latitude,longitude:n.longitude}}),{latitude:n.latitude,longitude:n.longitude,name:n.name}}async function rt(r,e){u.info("Fetching weather data",{component:"weatherService",additionalData:{latitude:r,longitude:e}});const t=new URLSearchParams({latitude:r.toString(),longitude:e.toString(),current_weather:"true"}),s=await fetch(`${xe}?${t.toString()}`);if(!s.ok){const a=new Error("Failed to fetch weather data");throw u.error("Weather API request failed",a,{component:"weatherService",additionalData:{latitude:r,longitude:e,status:s.status,statusText:s.statusText}}),a}const n=await s.json();if(!n.current_weather){const a=new Error("Invalid weather data received");throw u.error("Invalid weather data structure",a,{component:"weatherService",additionalData:{latitude:r,longitude:e,hasCurrentWeather:!!n.current_weather,dataKeys:Object.keys(n)}}),a}const o={temperature:n.current_weather.temperature,weatherCode:n.current_weather.weathercode,isDay:n.current_weather.is_day===1};return u.debug("Successfully retrieved weather data",{component:"weatherService",additionalData:{latitude:r,longitude:e,temperature:o.temperature,weatherCode:o.weatherCode,isDay:o.isDay}}),o}const H={log:r=>{}},Ce={maxSize:500,maxAge:1440*60*1e3,memoryLimit:50,autoCleanupInterval:300*1e3};class Fe{constructor(e={}){this.options={...Ce,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,t){let s;if(typeof e=="string"&&t)s=`${e}|${t}`;else if(typeof e=="object")s=this.getKey(e);else throw new Error("Invalid arguments to get()");const n=this.cache.get(s);return n?(this.cache.delete(s),this.cache.set(s,{article:n.article,timestamp:n.timestamp}),this.stats.hits++,n.article):(this.stats.misses++,null)}set(e){const t=this.getKey(e);this.cache.delete(t),this.cache.set(t,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(t=>this.set(t))}has(e,t){let s;if(typeof e=="string"&&t)s=`${e}|${t}`;else if(typeof e=="object")s=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(s)}delete(e,t){let s;if(typeof e=="string"&&t)s=`${e}|${t}`;else if(typeof e=="object")s=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(s)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let t=0,s=e,n=0;this.cache.forEach(({timestamp:m})=>{t+=e-m,m<s&&(s=m),m>n&&(n=m)});const o=this.cache.size,a=o>0?t/o:0,i=o>0?e-s:0,h=o>0?e-n:0;let c=null;return"memory"in performance&&(c=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:o,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:i,newestItemAge:h,averageAge:a,memoryUsage:c}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const t=Array.from(this.cache.entries()).sort((s,n)=>s[1].timestamp-n[1].timestamp);for(let s=0;s<e;s++)s<t.length&&(this.cache.delete(t[s][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((t,s)=>{e-t.timestamp>this.options.maxAge&&(this.cache.delete(s),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const t=performance.memory.usedJSHeapSize/(1024*1024);if(t<this.options.memoryLimit)return;const s=Math.max(1,Math.ceil(this.cache.size*.1)),n=Array.from(this.cache.entries()).sort((o,a)=>o[1].timestamp-a[1].timestamp);for(let o=0;o<s&&o<n.length;o++)this.cache.delete(n[o][0]),this.stats.evictions++;H.log(`Evicted ${s} articles from cache due to memory limit (${t.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),H.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const st=new Fe,Y=600*1e3,Z=100,Q=7200*1e3,$="smart-feed-cache";class Ie{constructor(e={}){this.cache=new Map,this.stats={hits:0,misses:0,sets:0,evictions:0},this.options={ttl:e.ttl||Y,maxEntries:e.maxEntries||Z,enablePersistence:e.enablePersistence!==!1,enableStaleWhileRevalidate:e.enableStaleWhileRevalidate||Q},this.options.enablePersistence&&this.loadFromStorage(),this.setupPeriodicCleanup()}get(e){const t=this.cache.get(e);if(!t)return this.stats.misses++,null;const s=Date.now(),n=s-t.timestamp;return t.accessCount++,t.lastAccessed=s,n<=this.options.ttl?(this.stats.hits++,u.debug("Cache hit for feed (fresh)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),ttl:Math.round(this.options.ttl/1e3),articlesCount:t.articles.length}}),t.articles):n<=this.options.enableStaleWhileRevalidate?(this.stats.hits++,u.debug("Cache hit for feed (stale)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3),articlesCount:t.articles.length}}),t.articles):(this.cache.delete(e),this.stats.misses++,u.debug("Cache expired for feed",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3)}}),null)}getStaleWhileRevalidate(e){const t=this.cache.get(e);if(!t)return null;const s=Date.now(),n=s-t.timestamp;return n<=this.options.enableStaleWhileRevalidate?(t.lastAccessed=s,u.debug("Serving stale content while revalidating",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),articlesCount:t.articles.length}}),t.articles):null}isFresh(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp<=this.options.ttl:!1}isStale(e){const t=this.cache.get(e);if(!t)return!1;const s=Date.now()-t.timestamp;return s>this.options.ttl&&s<=this.options.enableStaleWhileRevalidate}set(e,t,s,n){const o=Date.now(),a={articles:t.map(i=>({...i,pubDate:new Date(i.pubDate)})),timestamp:o,feedUrl:e,title:s,etag:n?.get("etag")||void 0,lastModified:n?.get("last-modified")||void 0,accessCount:1,lastAccessed:o};this.cache.size>=this.options.maxEntries&&this.evictLeastRecentlyUsed(),this.cache.set(e,a),this.stats.sets++,u.debug("Cached articles for feed",{component:"SmartCache",additionalData:{feedUrl:e,articlesCount:t.length,title:s,hasEtag:!!a.etag,hasLastModified:!!a.lastModified,cacheSize:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()}delete(e){const t=this.cache.delete(e);return t&&(u.debug("Removed cache entry for feed",{component:"SmartCache",additionalData:{feedUrl:e}}),this.options.enablePersistence&&this.persistToStorage()),t}clear(){const e=this.cache.size;this.cache.clear(),u.info("Cleared all cache entries",{component:"SmartCache",additionalData:{clearedEntries:e}}),this.options.enablePersistence&&this.persistToStorage()}getStats(){const e=Array.from(this.cache.values()),t=e.reduce((o,a)=>o+a.articles.length,0),s=e.map(o=>o.timestamp),n=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0;return{totalEntries:this.cache.size,totalArticles:t,cacheSize:this.estimateCacheSize(),hitRate:n,oldestEntry:s.length>0?Math.min(...s):0,newestEntry:s.length>0?Math.max(...s):0}}getKeys(){return Array.from(this.cache.keys())}has(e){return this.cache.has(e)}getMetadata(e){const t=this.cache.get(e);if(!t)return null;const{articles:s,...n}=t;return n}cleanup(){const e=Date.now(),t=[];for(const[s,n]of this.cache.entries())e-n.timestamp>this.options.enableStaleWhileRevalidate&&t.push(s);return t.forEach(s=>this.cache.delete(s)),t.length>0&&(u.info("Cleaned up expired cache entries",{component:"SmartCache",additionalData:{expiredCount:t.length,remainingCount:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()),t.length}evictLeastRecentlyUsed(){let e=null,t=Date.now();for(const[s,n]of this.cache.entries())n.lastAccessed<t&&(t=n.lastAccessed,e=s);e&&(this.cache.delete(e),this.stats.evictions++,u.debug("Evicted LRU cache entry",{component:"SmartCache",additionalData:{evictedKey:e,lastAccessed:new Date(t).toISOString()}}))}estimateCacheSize(){let e=0;for(const t of this.cache.values())e+=JSON.stringify(t).length*2;return e}loadFromStorage(){try{const e=localStorage.getItem($);if(!e)return;const t=JSON.parse(e),s=Date.now();for(const[n,o]of t.entries||[]){const a={...o,articles:o.articles.map(h=>({...h,pubDate:new Date(h.pubDate)}))};s-a.timestamp<=this.options.enableStaleWhileRevalidate&&this.cache.set(n,a)}u.info("Loaded cache from storage",{component:"SmartCache",additionalData:{loadedEntries:this.cache.size,totalStored:t.entries?.length||0}})}catch(e){u.error("Failed to load cache from storage",e,{component:"SmartCache"}),localStorage.removeItem($)}}persistToStorage(){try{const e=Array.from(this.cache.entries()).map(([s,n])=>[s,{...n,articles:n.articles.map(o=>({...o,pubDate:o.pubDate.toISOString()}))}]),t={entries:e,timestamp:Date.now(),version:"1.0.0"};localStorage.setItem($,JSON.stringify(t)),u.debug("Persisted cache to storage",{component:"SmartCache",additionalData:{entriesCount:e.length,estimatedSize:JSON.stringify(t).length}})}catch(e){u.error("Failed to persist cache to storage",e,{component:"SmartCache",additionalData:{cacheSize:this.cache.size,estimatedSize:this.estimateCacheSize()}})}}setupPeriodicCleanup(){setInterval(()=>{this.cleanup()},300*1e3)}}const z=new Ie({ttl:Y,maxEntries:Z,enablePersistence:!0,enableStaleWhileRevalidate:Q}),De=r=>z.get(r),Re=(r,e,t,s)=>{z.set(r,e,t,s)},nt=r=>z.isFresh(r),ee={maxXmlSize:10*1024*1024,allowedRootElements:["rss","feed","rdf:rdf","rdf"],blockedPatterns:[/<!ENTITY[^>]*SYSTEM/i,/<!ENTITY[^>]*PUBLIC/i,/javascript:/gi,/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/on\w+\s*=\s*["'][^"']*["']/gi,/data:text\/html/gi,/vbscript:/gi,/expression\s*\(/gi]};function te(r,e){if(r.length>e.maxXmlSize)throw new Error(`XML size exceeds security limit of ${e.maxXmlSize} bytes`);for(const t of e.blockedPatterns)if(t.test(r))throw new Error("Potentially malicious XML content detected: blocked pattern found")}function Ae(r,e){const t=r.documentElement;if(!t)throw new Error("No valid XML root element found");const s=t.tagName.toLowerCase();if(!e.allowedRootElements.some(o=>s===o.toLowerCase()))throw new Error(`Root element '${s}' is not in allowed list: ${e.allowedRootElements.join(", ")}`);const n=Array.from(r.childNodes).filter(o=>o.nodeType===Node.ELEMENT_NODE);if(n.length>1)throw new Error(`XML contains ${n.length} root nodes, but only 1 is allowed`)}function P(r){if(!r)return"";let e=r;return e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'"),e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/expression\s*\(/gi,"").replace(/<[^>]*>/g,""),e=e.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").trim(),e}function $e(r,e){if(!r)return"";const s=r.querySelector(e)?.textContent||"";return P(s)}function Ne(r,e){if(!r)return"";const t=r.getAttribute(e)||"";return P(t)}function Me(r,e=ee){try{if(!r||typeof r!="string")throw new Error("Invalid XML input: must be a non-empty string");const t=r.trim();if(!t)throw new Error("Invalid XML input: must be a non-empty string");te(t,e);const n=new DOMParser().parseFromString(t,"application/xml"),o=n.querySelector("parsererror");if(o)throw new Error(`XML parsing error: ${o.textContent}`);return Ae(n,e),n}catch(t){throw console.error("Secure XML parsing error:",t),new Error(`Failed to parse XML securely: ${t instanceof Error?t.message:"Unknown error"}`)}}function ze(r){const e={...ee,allowedRootElements:["rss","feed","rdf:rdf","rdf"]};return Me(r,e)}const L={getSecureTextContent:$e,getSecureAttributeValue:Ne,sanitizeTextContent:P,validateXmlSecurity:te},Pe=[{original:"http://feeds.feedburner.com/tecnoblog",alternatives:["https://tecnoblog.net/feed/","https://tecnoblog.net/rss/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/Techcrunch",alternatives:["https://techcrunch.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/blogdoiphone/rss",alternatives:["https://blogdoiphone.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://macmagazine.com.br/feed/",alternatives:["https://macmagazine.com.br/feed/"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds2.feedburner.com/canaltechbr",alternatives:["https://canaltech.com.br/rss/","https://canaltech.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/guiadopc",alternatives:["https://guiadopc.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://meiobit.com/index.xml",alternatives:["https://meiobit.com/feed/","https://meiobit.com/index.xml"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds.feedburner.com/design-milk",alternatives:["https://design-milk.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/core77/blog",alternatives:["https://www.core77.com/rss/object.xml"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/dezeen",alternatives:["https://www.dezeen.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/JustCreativeDesignBlog",alternatives:["https://justcreative.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds2.feedburner.com/thenextweb",alternatives:["https://thenextweb.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/brainstorm9",alternatives:["https://www.brainstorm9.com/feed/"],notes:"FeedBurner redirect to direct feed"}];function Le(r){const e=[r],t=Pe.find(s=>s.original===r);if(t&&e.push(...t.alternatives),r.startsWith("http://")){const s=r.replace("http://","https://");e.includes(s)||e.push(s)}return[...new Set(e)]}const Ue=8e3,ke=2,Be=500,y=w(),Oe=[{name:"RSS2JSON",url:"https://api.rss2json.com/v1/api.json",format:r=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(r)}`,parser:je},{name:"AllOrigins",url:"https://api.allorigins.win/raw",format:r=>`https://api.allorigins.win/raw?url=${encodeURIComponent(r)}`,parser:N},{name:"CodeTabs",url:"https://api.codetabs.com/v1/proxy",format:r=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r)}`,parser:N},{name:"CORSProxy",url:"https://corsproxy.io",format:r=>`https://corsproxy.io/?${encodeURIComponent(r)}`,parser:N}];class We{constructor(){this.failures=new Map,this.threshold=3,this.timeout=6e4}isOpen(e){const t=this.failures.get(e);return t?Date.now()-t.lastAttempt>this.timeout?(this.failures.delete(e),!1):t.count>=this.threshold:!1}recordFailure(e){const t=this.failures.get(e)||{count:0,lastAttempt:0};t.count++,t.lastAttempt=Date.now(),this.failures.set(e,t)}recordSuccess(e){this.failures.delete(e)}}const M=new We;function re(r){return L.sanitizeTextContent(r)}function x(r){return L.sanitizeTextContent(r)}function se(r){return L.sanitizeTextContent(r)}async function _e(r,e={}){const{timeout:t=Ue,...s}=e,n=new AbortController,o=setTimeout(()=>n.abort(),t);try{const a=await fetch(r,{...s,signal:n.signal,headers:{Accept:"application/rss+xml, application/xml, application/atom+xml, text/xml, application/json, */*",...s.headers}});return clearTimeout(o),a}catch(a){throw clearTimeout(o),a instanceof Error&&a.name==="AbortError"?new Error(`Request timeout after ${t}ms`):a}}function je(r,e){const t=JSON.parse(r);if(t.status==="error")throw new Error(`RSS2JSON error: ${t.message||"Unknown error"}`);if(t.status!=="ok"||!t.items)throw new Error("Invalid RSS2JSON response format");const s=t.items.map(n=>{let o=n.thumbnail||n.enclosure?.link;if(o)try{new URL(o).protocol.startsWith("http")||(o=void 0),o&&(o.includes("?text=")||o.match(/^[A-Z0-9]{6}\?text=/i)||!o.includes("."))&&(o=void 0)}catch{o=void 0}return{title:n.title?x(n.title):"No Title",link:n.link||e,pubDate:n.pubDate?new Date(n.pubDate):new Date,description:n.description?re(n.description).substring(0,200):"",sourceTitle:t.feed?.title?x(t.feed.title):"RSS Feed",author:n.author?se(n.author):void 0,categories:n.categories||[],imageUrl:o||void 0}});return{title:t.feed?.title||"RSS Feed",articles:s}}function N(r,e){const t=ze(r),s=t.getElementsByTagName("parsererror");if(s.length>0)throw new Error(`XML parsing error: ${s[0].textContent}`);let n="Untitled Feed",o;const a=t.getElementsByTagName("channel");if(a.length>0)n=a[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",n=x(n),o=t.getElementsByTagName("item");else{const h=t.getElementsByTagName("feed");if(h.length>0)n=h[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",n=x(n),o=t.getElementsByTagName("entry");else{const c=t.getElementsByTagName("item");if(c.length>0){const m=t.getElementsByTagName("channel");m.length>0&&(n=m[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",n=x(n)),o=c}else throw new Error("Unsupported RSS format")}}const i=[];for(let h=0;h<Math.min(o.length,50);h++){const c=o[h];try{const f=c.getElementsByTagName("title")[0]?.textContent?.trim()||"No Title",S=x(f);let E="";const A=c.getElementsByTagName("link");A.length>0&&(E=A[0].textContent?.trim()||A[0].getAttribute("href")||"");let U=new Date;const oe=c.getElementsByTagName("pubDate"),ae=c.getElementsByTagName("published"),ie=c.getElementsByTagName("date"),k=oe[0]||ae[0]||ie[0];if(k?.textContent){const d=new Date(k.textContent.trim());isNaN(d.getTime())||(U=d)}let B="";const ce=c.getElementsByTagName("description"),le=c.getElementsByTagName("summary"),he=c.getElementsByTagName("content"),C=ce[0]||le[0]||he[0];C?.textContent&&(B=re(C.textContent).substring(0,200));let O="";const de=c.getElementsByTagName("author"),ue=c.getElementsByTagName("creator"),W=de[0]||ue[0];if(W?.textContent){const d=W.textContent.trim();O=se(d)}const _=[],j=c.getElementsByTagName("category");for(let d=0;d<j.length;d++){const p=j[d].textContent?.trim();p&&_.push(p)}let g="";const X=c.getElementsByTagName("enclosure");for(let d=0;d<X.length;d++){const p=X[d],b=p.getAttribute("type");if(b&&b.startsWith("image/")){g=p.getAttribute("url")||"";break}}if(!g){const d=c.getElementsByTagName("media:content");for(let p=0;p<d.length;p++){const b=d[p],v=b.getAttribute("type");if(v&&v.startsWith("image/")){g=b.getAttribute("url")||"";break}}}if(!g){const d=c.getElementsByTagName("media:thumbnail");d.length>0&&(g=d[0].getAttribute("url")||"")}if(!g&&C){const d=C.innerHTML||C.textContent||"",p=[/<img[^>]+src=["']([^"']+)["'][^>]*>/i,/src=["']([^"']+\.(?:jpg|jpeg|png|gif|webp|svg))[^"']*/i,/https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|svg)/i];for(const b of p){const v=d.match(b);if(v&&v[1]){g=v[1];break}}}let G;if(g)try{const d=new URL(g);(d.protocol==="http:"||d.protocol==="https:")&&!g.includes("?text=")&&!g.match(/^[A-Z0-9]{6}\?text=/i)&&g.includes(".")&&(G=g)}catch{y.debug(`Invalid image URL filtered: ${g}`,{component:"rssParser"})}S!=="No Title"&&E&&i.push({title:S,link:E,pubDate:U,description:B,imageUrl:G,author:O||void 0,categories:_,sourceTitle:n})}catch(m){y.warn(`Failed to parse article ${h+1}`,{component:"rssParser",additionalData:{error:m instanceof Error?m.message:String(m)}})}}return{title:n,articles:i}}function Xe(r){if(!r||r.trim().length===0)return!1;const e=r.trim();return e.toLowerCase().includes("<!doctype html")||e.toLowerCase().startsWith("<html")?!1:e.startsWith("<")||e.startsWith("{")}async function Ge(r,e,t){if(M.isOpen(r.name))throw new Error(`Circuit breaker open for ${r.name}`);const s=r.format(e);y.debug(`Trying provider: ${r.name}`,{component:"rssParser",additionalData:{feedUrl:e,proxyUrl:s}});const n=await _e(s,{signal:t});if(!n.ok)throw n.status===422?new Error(`Provider ${r.name} cannot process this feed (422 Unprocessable Entity)`):new Error(`Provider ${r.name} returned ${n.status}: ${n.statusText}`);const o=await n.text();if(!Xe(o))throw new Error(`Invalid response from ${r.name}`);const a=r.parser(o,e);if(!a.articles||a.articles.length===0)throw new Error(`No articles parsed from ${r.name}`);return M.recordSuccess(r.name),y.info(`Successfully fetched via ${r.name}`,{component:"rssParser",additionalData:{feedUrl:e,provider:r.name,articlesCount:a.articles.length}}),a}async function Je(r,e){const t=Le(r);let s=new Error("Unknown error");for(const n of t)for(const o of Oe)try{return await Ge(o,n,e)}catch(a){s=a instanceof Error?a:new Error(String(a)),M.recordFailure(o.name),y.debug(`Provider ${o.name} failed for ${n}`,{component:"rssParser",additionalData:{error:s.message}})}throw new Error(`All providers failed. Last error: ${s.message}`)}function Ke(r){return new Promise(e=>setTimeout(e,r))}async function He(r,e={}){const{maxRetries:t=ke,signal:s}=e;let n=new Error("Unknown error");for(let o=1;o<=t;o++)try{y.debug(`Fetching feed (attempt ${o}/${t})`,{component:"rssParser",additionalData:{feedUrl:r}});const a=await Je(r,s);return a.articles.length>0&&Re(r,a.articles,a.title),y.info(`Successfully fetched feed on attempt ${o}`,{component:"rssParser",additionalData:{feedUrl:r,articlesCount:a.articles.length,attempt:o}}),a}catch(a){if(n=a instanceof Error?a:new Error(String(a)),s?.aborted)throw new Error("Request was cancelled");if(o===t)break;const i=Be*Math.pow(2,o-1);y.warn(`Attempt ${o} failed, retrying in ${i}ms`,{component:"rssParser",additionalData:{feedUrl:r,error:n.message}}),await Ke(i)}throw y.error(`All ${t} attempts failed`,n,{component:"rssParser",additionalData:{feedUrl:r}}),n}async function ot(r,e={}){const{skipCache:t=!1}=e;if(!t){const s=De(r);if(s&&s.length>0)return y.debug("Using cached articles",{component:"rssParser",additionalData:{feedUrl:r,cachedCount:s.length}}),{title:s[0].sourceTitle,articles:s}}try{return await He(r,e)}catch(s){return y.warn("Creating placeholder for failed feed",{component:"rssParser",additionalData:{url:r,error:s instanceof Error?s.message:String(s)}}),{title:"Feed Unavailable",articles:[{title:"RSS Feed Temporarily Unavailable",link:r,pubDate:new Date,description:"Unable to fetch this RSS feed. This may be due to CORS restrictions or temporary server issues. The feed will be retried automatically.",sourceTitle:"System Notice",categories:["system","unavailable"]}]}}}function at(r){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("outline"),n=[];for(let o=0;o<s.length;o++){const i=s[o].getAttribute("xmlUrl");i&&n.push(i)}return n}const l=r=>{const e=r.replace("#","");if(!/^[a-fA-F0-9]{3}$|^[a-fA-F0-9]{6}$/.test(e))throw new Error(`Invalid hex color format: ${r}. Expected format: #RRGGBB or #RGB`);let t,s,n;if(e.length===3?(t=parseInt(e[0]+e[0],16),s=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16)):(t=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16)),isNaN(t)||isNaN(s)||isNaN(n)||t<0||t>255||s<0||s>255||n<0||n>255)throw new Error(`Invalid hex color conversion result: ${r} -> ${t} ${s} ${n}`);return`${t} ${s} ${n}`},R=[{id:"noite-urbana",name:"Noite Urbana",description:"Tema escuro urbano com azul médio e acentos âmbar",category:"dark",theme:{id:"noite-urbana",name:"Noite Urbana",colors:{primary:"18 102 204",secondary:l("#1E1E1E"),accent:"138 101 8",background:l("#121212"),surface:l("#1E1E1E"),text:l("#FFFFFF"),textSecondary:l("#B0B0B0"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verde-noturno",name:"Verde Noturno",description:"Tema escuro com verde natural e acentos solares",category:"dark",theme:{id:"verde-noturno",name:"Verde Noturno",colors:{primary:"52 125 54",secondary:l("#1B1F1D"),accent:"122 105 17",background:l("#0D0D0D"),surface:l("#1B1F1D"),text:l("#F1F1F1"),textSecondary:l("#A8A8A8"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"roxo-nebuloso",name:"Roxo Nebuloso",description:"Tema escuro místico com roxo vibrante e rosa neon",category:"dark",theme:{id:"roxo-nebuloso",name:"Roxo Nebuloso",colors:{primary:"173 46 207",secondary:l("#1A1A23"),accent:"204 51 102",background:l("#101014"),surface:l("#1A1A23"),text:l("#E0E0E0"),textSecondary:l("#9C9C9C"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"solar-clean",name:"Solar Clean",description:"Tema claro limpo com azul clássico e laranja queimado",category:"light",theme:{id:"solar-clean",name:"Solar Clean",colors:{primary:l("#1976D2"),secondary:l("#F5F5F5"),accent:"184 61 23",background:l("#FFFFFF"),surface:l("#F5F5F5"),text:l("#212121"),textSecondary:l("#616161"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verao-pastel",name:"Verão Pastel",description:"Tema claro pastel com rosa vibrante e lilás suave",category:"light",theme:{id:"verao-pastel",name:"Verão Pastel",colors:{primary:"178 48 92",secondary:l("#FFFFFF"),accent:l("#7E57C2"),background:l("#FFF8F0"),surface:l("#FFFFFF"),text:l("#212121"),textSecondary:"97 97 97",border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"minimal-ice",name:"Minimal Ice",description:"Tema claro minimalista com ciano frio e coral quente",category:"light",theme:{id:"minimal-ice",name:"Minimal Ice",colors:{primary:"0 129 145",secondary:l("#FFFFFF"),accent:"184 81 49",background:l("#F0F4F8"),surface:l("#FFFFFF"),text:l("#1C1C1C"),textSecondary:l("#5E5E5E"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],it={currentTheme:R.find(r=>r.id==="solar-clean")?.theme||R[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},ne=r=>{const e=["id","name","colors","layout","density","borderRadius"],t=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const s of e)if(!(s in r))return console.warn(`Theme validation failed: missing field "${s}"`),!1;if(r.colors){for(const s of t)if(!(s in r.colors))return console.warn(`Theme validation failed: missing color "${s}"`),!1}if(r.colors){for(const[s,n]of Object.entries(r.colors))if(!Ve(n))return console.warn(`Theme validation failed: invalid RGB format for color "${s}": "${n}"`),!1}return!0},Ve=r=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(r)?r.split(/\s+/).map(Number).every(s=>s>=0&&s<=255):!1,ct=(r,e="1.0")=>{try{if(typeof r=="string")return V(r,"Migrated Theme");if(ne(r))return r;if(r.colors?.accent||r.accent){const t=r.colors?.accent||r.accent;return V(t,r.name||"Migrated Theme")}return null}catch(t){return console.error("Theme migration failed:",t),null}},V=(r,e)=>{const t=r.split(/\s+/).map(Number),[s,n,o]=t,a=s*.299+n*.587+o*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:r,secondary:a?"45 55 72":"229 231 235",accent:r,background:a?"26 32 44":"255 255 255",surface:a?"45 55 72":"249 250 251",text:a?"247 250 252":"17 24 39",textSecondary:a?"160 174 192":"107 114 128",border:a?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},lt=r=>{const e=document.documentElement;Object.entries(r.colors).forEach(([i,h])=>{e.style.setProperty(`--color-${i}`,h)});const s={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[r.layout];e.style.setProperty("--layout-padding",s.padding),e.style.setProperty("--layout-gap",s.gap);const o={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[r.density];e.style.setProperty("--density-font-size",o.fontSize),e.style.setProperty("--density-line-height",o.lineHeight);const a={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",a[r.borderRadius]),e.style.setProperty("--shadows-enabled",r.shadows?"1":"0"),e.style.setProperty("--animations-enabled",r.animations?"1":"0"),e.style.setProperty("--transition-duration",r.animations?"0.2s":"0s")},ht=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",dt=r=>{const e=R.filter(t=>t.category===r||r==="dark"&&t.category==="colorful");return e.length>0?e[0].theme:R[0].theme},ut=r=>JSON.stringify(r,null,2),mt=r=>{try{const e=JSON.parse(r);return ne(e)?e:null}catch(e){return console.error("Failed to import theme:",e),null}};export{st as a,Ye as b,rt as c,it as d,ht as e,dt as f,tt as g,Qe as h,lt as i,R as j,l as k,ut as l,ct as m,mt as n,De as o,at as p,ot as q,nt as r,Ze as s,ve as t,et as u,ne as v};
