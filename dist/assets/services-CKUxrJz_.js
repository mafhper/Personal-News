import"./performance-CzN0QyaO.js";function He(s){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return s.forEach((t,r)=>{const n=`${t.link}-${r}`;e.articles.set(n,t),C(t.title).forEach(i=>{e.titleIndex.has(i)||e.titleIndex.set(i,[]),e.titleIndex.get(i).push(n)}),t.description&&C(t.description).forEach(h=>{e.contentIndex.has(h)||e.contentIndex.set(h,[]),e.contentIndex.get(h).push(n)}),t.categories&&t.categories.forEach(i=>{C(i).forEach(c=>{e.categoryIndex.has(c)||e.categoryIndex.set(c,[]),e.categoryIndex.get(c).push(n)})}),C(t.sourceTitle).forEach(i=>{e.sourceIndex.has(i)||e.sourceIndex.set(i,[]),e.sourceIndex.get(i).push(n)})}),e}function C(s){return s.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function Ve(s,e,t={}){const{includeTitle:r=!0,includeContent:n=!0,includeCategories:o=!0,includeSource:a=!0,fuzzyThreshold:i=.6}=t;if(!e.trim())return[];const h=C(e),c=new Map;h.forEach(f=>{r&&I(s.titleIndex,f,i,c,"title",3),n&&I(s.contentIndex,f,i,c,"content",1),o&&I(s.categoryIndex,f,i,c,"category",2),a&&I(s.sourceIndex,f,i,c,"source",1.5)});const m=[];return c.forEach((f,b)=>{const E=s.articles.get(b);E&&m.push({article:E,score:f.score,matchedFields:Array.from(f.matchedFields)})}),m.sort((f,b)=>b.score-f.score)}function I(s,e,t,r,n,o){s.forEach((a,i)=>{const h=le(e,i);if(h>=t){const c=h*o;a.forEach(m=>{r.has(m)||r.set(m,{score:0,matchedFields:new Set});const f=r.get(m);f.score+=c,f.matchedFields.add(n)})}})}function le(s,e){if(s===e)return 1;if(s.includes(e)||e.includes(s))return .9;const t=Math.max(s.length,e.length);return t===0?1:1-he(s,e)/t}function he(s,e){const t=Array(e.length+1).fill(null).map(()=>Array(s.length+1).fill(null));for(let r=0;r<=s.length;r++)t[0][r]=r;for(let r=0;r<=e.length;r++)t[r][0]=r;for(let r=1;r<=e.length;r++)for(let n=1;n<=s.length;n++){const o=s[n-1]===e[r-1]?0:1;t[r][n]=Math.min(t[r][n-1]+1,t[r-1][n]+1,t[r-1][n-1]+o)}return t[e.length][s.length]}function qe(s,e){if(!e.trim())return s;const t=e.trim().split(/\s+/);let r=s;return t.forEach(n=>{const o=de(n),a=new RegExp(`(${o})`,"gi");r=r.replace(a,"<mark>$1</mark>")}),r}function de(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const j={DEBUG:0,INFO:1,WARN:2,ERROR:3},ue=s=>({level:"WARN",enableContextInjection:!0,enableCorrelationIds:!0,maxLogEntries:1e3,environment:s,transports:[{type:"console",enabled:!0,level:"WARN"},{type:"localStorage",enabled:!1,level:"INFO",batchSize:50,flushInterval:3e4},{type:"remote",enabled:!1,level:"WARN",batchSize:100,flushInterval:6e4,endpoint:"/api/logs"}]}),K=s=>({name:s.name,message:s.message,stack:s.stack,cause:s.cause?K(s.cause):void 0}),x=(s,e)=>j[s]>=j[e],X=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,me=s=>{const e=new Date(s.timestamp).toISOString(),t=s.context.component?`[${s.context.component}]`:"",r=s.correlationId?`(${s.correlationId})`:"";return`${e} ${s.level} ${t}${r} ${s.message}`};class fe{constructor(e){this.config=e}configure(e){this.config=e}async send(e){if(!this.config.enabled||!x(e.level,this.config.level))return;const t=me(e),r={...e.context,error:e.error};switch(e.level){case"DEBUG":console.debug(t,r);break;case"INFO":console.info(t,r);break;case"WARN":console.warn(t,r);break;case"ERROR":console.error(t,r);break}}async batch(e){for(const t of e)await this.send(t)}async flush(){}}class ge{constructor(e){this.buffer=[],this.storageKey="app-logs",this.config=e,this.startFlushTimer()}configure(e){this.config=e,this.startFlushTimer()}async send(e){!this.config.enabled||!x(e.level,this.config.level)||(this.buffer.push(e),this.buffer.length>=(this.config.batchSize||50)&&await this.flush())}async batch(e){const t=e.filter(r=>this.config.enabled&&x(r.level,this.config.level));this.buffer.push(...t),this.buffer.length>=(this.config.batchSize||50)&&await this.flush()}async flush(){if(this.buffer.length!==0)try{const n=[...this.getStoredLogs(),...this.buffer].slice(-1e3);localStorage.setItem(this.storageKey,JSON.stringify(n)),this.buffer=[]}catch(e){console.error("Failed to store logs in localStorage:",e)}}getStoredLogs(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch{return[]}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.config.flushInterval&&(this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval))}}class pe{constructor(e){this.buffer=[],this.config=e,this.startFlushTimer()}configure(e){this.config=e,this.startFlushTimer()}async send(e){!this.config.enabled||!x(e.level,this.config.level)||(this.buffer.push(e),this.buffer.length>=(this.config.batchSize||100)&&await this.flush())}async batch(e){const t=e.filter(r=>this.config.enabled&&x(r.level,this.config.level));this.buffer.push(...t),this.buffer.length>=(this.config.batchSize||100)&&await this.flush()}async flush(){if(this.buffer.length===0||!this.config.endpoint)return;const e=[...this.buffer];this.buffer=[];try{const t=await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify({logs:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(t){console.error("Failed to send logs to remote endpoint:",t),this.buffer.unshift(...e)}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.config.flushInterval&&(this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval))}}class ye{constructor(e){this.transports=[],this.globalContext={},this.config=e,this.sessionId=X(),this.initializeTransports(),this.initializeGlobalContext()}initializeTransports(){this.transports=this.config.transports.map(e=>{switch(e.type){case"console":return new fe(e);case"localStorage":return new ge(e);case"remote":return new pe(e);default:throw new Error(`Unknown transport type: ${e.type}`)}})}initializeGlobalContext(){this.config.enableContextInjection&&(this.globalContext={sessionId:this.sessionId,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0,timestamp:Date.now()})}setContext(e){this.globalContext={...this.globalContext,...e}}getContext(){return{...this.globalContext}}debug(e,t){this.log("DEBUG",e,void 0,t)}info(e,t){this.log("INFO",e,void 0,t)}warn(e,t){this.log("WARN",e,void 0,t)}error(e,t,r){this.log("ERROR",e,t,r)}log(e,t,r,n){if(!x(e,this.config.level))return;const o={level:e,message:t,timestamp:Date.now(),context:{...this.globalContext,...n,url:typeof window<"u"?window.location.href:this.globalContext.url},error:r?K(r):void 0,correlationId:this.config.enableCorrelationIds?X():void 0};this.transports.forEach(a=>{a.send(o).catch(i=>{console.error("Transport failed to send log:",i)})})}async flush(){await Promise.all(this.transports.map(e=>e.flush()))}}let F=null;const we=s=>{const r={...ue("production"),...s};return F=new ye(r),F},w=()=>(F||(F=we()),F),u={debug:(s,e)=>w().debug(s,e),info:(s,e)=>w().info(s,e),warn:(s,e)=>w().warn(s,e),error:(s,e,t)=>w().error(s,e,t),setContext:s=>w().setContext(s),getContext:()=>w().getContext(),flush:()=>w().flush()},Ye=s=>{const e=w();return{debug:(t,r)=>e.debug(t,{...r,component:s}),info:(t,r)=>e.info(t,{...r,component:s}),warn:(t,r)=>e.warn(t,{...r,component:s}),error:(t,r,n)=>e.error(t,r,{...n,component:s}),setContext:t=>e.setContext(t),getContext:()=>e.getContext()}},be="https://api.open-meteo.com/v1/forecast",Se="https://geocoding-api.open-meteo.com/v1/search";async function Ze(s){u.info("Fetching coordinates for city",{component:"weatherService",additionalData:{cityName:s}});const e=new URLSearchParams({name:s,count:"1",language:"en",format:"json"}),t=await fetch(`${Se}?${e.toString()}`);if(!t.ok){const o=new Error("Failed to fetch geocoding data");throw u.error("Geocoding API request failed",o,{component:"weatherService",additionalData:{cityName:s,status:t.status,statusText:t.statusText}}),o}const r=await t.json();if(!r.results||r.results.length===0)return u.warn("City not found in geocoding results",{component:"weatherService",additionalData:{cityName:s,resultsCount:r.results?.length||0}}),null;const n=r.results[0];return u.debug("Successfully retrieved city coordinates",{component:"weatherService",additionalData:{cityName:s,foundCity:n.name,latitude:n.latitude,longitude:n.longitude}}),{latitude:n.latitude,longitude:n.longitude,name:n.name}}async function Qe(s,e){u.info("Fetching weather data",{component:"weatherService",additionalData:{latitude:s,longitude:e}});const t=new URLSearchParams({latitude:s.toString(),longitude:e.toString(),current_weather:"true"}),r=await fetch(`${be}?${t.toString()}`);if(!r.ok){const a=new Error("Failed to fetch weather data");throw u.error("Weather API request failed",a,{component:"weatherService",additionalData:{latitude:s,longitude:e,status:r.status,statusText:r.statusText}}),a}const n=await r.json();if(!n.current_weather){const a=new Error("Invalid weather data received");throw u.error("Invalid weather data structure",a,{component:"weatherService",additionalData:{latitude:s,longitude:e,hasCurrentWeather:!!n.current_weather,dataKeys:Object.keys(n)}}),a}const o={temperature:n.current_weather.temperature,weatherCode:n.current_weather.weathercode,isDay:n.current_weather.is_day===1};return u.debug("Successfully retrieved weather data",{component:"weatherService",additionalData:{latitude:s,longitude:e,temperature:o.temperature,weatherCode:o.weatherCode,isDay:o.isDay}}),o}const G={log:s=>{}},Ee={maxSize:500,maxAge:1440*60*1e3,memoryLimit:50,autoCleanupInterval:300*1e3};class ve{constructor(e={}){this.options={...Ee,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to get()");const n=this.cache.get(r);return n?(this.cache.delete(r),this.cache.set(r,{article:n.article,timestamp:n.timestamp}),this.stats.hits++,n.article):(this.stats.misses++,null)}set(e){const t=this.getKey(e);this.cache.delete(t),this.cache.set(t,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(t=>this.set(t))}has(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(r)}delete(e,t){let r;if(typeof e=="string"&&t)r=`${e}|${t}`;else if(typeof e=="object")r=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(r)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let t=0,r=e,n=0;this.cache.forEach(({timestamp:m})=>{t+=e-m,m<r&&(r=m),m>n&&(n=m)});const o=this.cache.size,a=o>0?t/o:0,i=o>0?e-r:0,h=o>0?e-n:0;let c=null;return"memory"in performance&&(c=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:o,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:i,newestItemAge:h,averageAge:a,memoryUsage:c}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const t=Array.from(this.cache.entries()).sort((r,n)=>r[1].timestamp-n[1].timestamp);for(let r=0;r<e;r++)r<t.length&&(this.cache.delete(t[r][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((t,r)=>{e-t.timestamp>this.options.maxAge&&(this.cache.delete(r),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const t=performance.memory.usedJSHeapSize/(1024*1024);if(t<this.options.memoryLimit)return;const r=Math.max(1,Math.ceil(this.cache.size*.1)),n=Array.from(this.cache.entries()).sort((o,a)=>o[1].timestamp-a[1].timestamp);for(let o=0;o<r&&o<n.length;o++)this.cache.delete(n[o][0]),this.stats.evictions++;G.log(`Evicted ${r} articles from cache due to memory limit (${t.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),G.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const et=new ve,H=600*1e3,V=100,q=7200*1e3,R="smart-feed-cache";class xe{constructor(e={}){this.cache=new Map,this.stats={hits:0,misses:0,sets:0,evictions:0},this.options={ttl:e.ttl||H,maxEntries:e.maxEntries||V,enablePersistence:e.enablePersistence!==!1,enableStaleWhileRevalidate:e.enableStaleWhileRevalidate||q},this.options.enablePersistence&&this.loadFromStorage(),this.setupPeriodicCleanup()}get(e){const t=this.cache.get(e);if(!t)return this.stats.misses++,null;const r=Date.now(),n=r-t.timestamp;return t.accessCount++,t.lastAccessed=r,n<=this.options.ttl?(this.stats.hits++,u.debug("Cache hit for feed (fresh)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),ttl:Math.round(this.options.ttl/1e3),articlesCount:t.articles.length}}),t.articles):n<=this.options.enableStaleWhileRevalidate?(this.stats.hits++,u.debug("Cache hit for feed (stale)",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3),articlesCount:t.articles.length}}),t.articles):(this.cache.delete(e),this.stats.misses++,u.debug("Cache expired for feed",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),staleLimit:Math.round(this.options.enableStaleWhileRevalidate/1e3)}}),null)}getStaleWhileRevalidate(e){const t=this.cache.get(e);if(!t)return null;const r=Date.now(),n=r-t.timestamp;return n<=this.options.enableStaleWhileRevalidate?(t.lastAccessed=r,u.debug("Serving stale content while revalidating",{component:"SmartCache",additionalData:{feedUrl:e,age:Math.round(n/1e3),articlesCount:t.articles.length}}),t.articles):null}isFresh(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp<=this.options.ttl:!1}isStale(e){const t=this.cache.get(e);if(!t)return!1;const r=Date.now()-t.timestamp;return r>this.options.ttl&&r<=this.options.enableStaleWhileRevalidate}set(e,t,r,n){const o=Date.now(),a={articles:t.map(i=>({...i,pubDate:new Date(i.pubDate)})),timestamp:o,feedUrl:e,title:r,etag:n?.get("etag")||void 0,lastModified:n?.get("last-modified")||void 0,accessCount:1,lastAccessed:o};this.cache.size>=this.options.maxEntries&&this.evictLeastRecentlyUsed(),this.cache.set(e,a),this.stats.sets++,u.debug("Cached articles for feed",{component:"SmartCache",additionalData:{feedUrl:e,articlesCount:t.length,title:r,hasEtag:!!a.etag,hasLastModified:!!a.lastModified,cacheSize:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()}delete(e){const t=this.cache.delete(e);return t&&(u.debug("Removed cache entry for feed",{component:"SmartCache",additionalData:{feedUrl:e}}),this.options.enablePersistence&&this.persistToStorage()),t}clear(){const e=this.cache.size;this.cache.clear(),u.info("Cleared all cache entries",{component:"SmartCache",additionalData:{clearedEntries:e}}),this.options.enablePersistence&&this.persistToStorage()}getStats(){const e=Array.from(this.cache.values()),t=e.reduce((o,a)=>o+a.articles.length,0),r=e.map(o=>o.timestamp),n=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0;return{totalEntries:this.cache.size,totalArticles:t,cacheSize:this.estimateCacheSize(),hitRate:n,oldestEntry:r.length>0?Math.min(...r):0,newestEntry:r.length>0?Math.max(...r):0}}getKeys(){return Array.from(this.cache.keys())}has(e){return this.cache.has(e)}getMetadata(e){const t=this.cache.get(e);if(!t)return null;const{articles:r,...n}=t;return n}cleanup(){const e=Date.now(),t=[];for(const[r,n]of this.cache.entries())e-n.timestamp>this.options.enableStaleWhileRevalidate&&t.push(r);return t.forEach(r=>this.cache.delete(r)),t.length>0&&(u.info("Cleaned up expired cache entries",{component:"SmartCache",additionalData:{expiredCount:t.length,remainingCount:this.cache.size}}),this.options.enablePersistence&&this.persistToStorage()),t.length}evictLeastRecentlyUsed(){let e=null,t=Date.now();for(const[r,n]of this.cache.entries())n.lastAccessed<t&&(t=n.lastAccessed,e=r);e&&(this.cache.delete(e),this.stats.evictions++,u.debug("Evicted LRU cache entry",{component:"SmartCache",additionalData:{evictedKey:e,lastAccessed:new Date(t).toISOString()}}))}estimateCacheSize(){let e=0;for(const t of this.cache.values())e+=JSON.stringify(t).length*2;return e}loadFromStorage(){try{const e=localStorage.getItem(R);if(!e)return;const t=JSON.parse(e),r=Date.now();for(const[n,o]of t.entries||[]){const a={...o,articles:o.articles.map(h=>({...h,pubDate:new Date(h.pubDate)}))};r-a.timestamp<=this.options.enableStaleWhileRevalidate&&this.cache.set(n,a)}u.info("Loaded cache from storage",{component:"SmartCache",additionalData:{loadedEntries:this.cache.size,totalStored:t.entries?.length||0}})}catch(e){u.error("Failed to load cache from storage",e,{component:"SmartCache"}),localStorage.removeItem(R)}}persistToStorage(){try{const e=Array.from(this.cache.entries()).map(([r,n])=>[r,{...n,articles:n.articles.map(o=>({...o,pubDate:o.pubDate.toISOString()}))}]),t={entries:e,timestamp:Date.now(),version:"1.0.0"};localStorage.setItem(R,JSON.stringify(t)),u.debug("Persisted cache to storage",{component:"SmartCache",additionalData:{entriesCount:e.length,estimatedSize:JSON.stringify(t).length}})}catch(e){u.error("Failed to persist cache to storage",e,{component:"SmartCache",additionalData:{cacheSize:this.cache.size,estimatedSize:this.estimateCacheSize()}})}}setupPeriodicCleanup(){setInterval(()=>{this.cleanup()},300*1e3)}}const N=new xe({ttl:H,maxEntries:V,enablePersistence:!0,enableStaleWhileRevalidate:q}),Te=s=>N.get(s),Ce=(s,e,t,r)=>{N.set(s,e,t,r)},tt=s=>N.isFresh(s),Y={maxXmlSize:10*1024*1024,allowedRootElements:["rss","feed","rdf:rdf","rdf"],blockedPatterns:[/<!ENTITY[^>]*SYSTEM/i,/<!ENTITY[^>]*PUBLIC/i,/javascript:/gi,/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/on\w+\s*=\s*["'][^"']*["']/gi,/data:text\/html/gi,/vbscript:/gi,/expression\s*\(/gi]};function Z(s,e){if(s.length>e.maxXmlSize)throw new Error(`XML size exceeds security limit of ${e.maxXmlSize} bytes`);for(const t of e.blockedPatterns)if(t.test(s))throw new Error("Potentially malicious XML content detected: blocked pattern found")}function Fe(s,e){const t=s.documentElement;if(!t)throw new Error("No valid XML root element found");const r=t.tagName.toLowerCase();if(!e.allowedRootElements.some(o=>r===o.toLowerCase()))throw new Error(`Root element '${r}' is not in allowed list: ${e.allowedRootElements.join(", ")}`);const n=Array.from(s.childNodes).filter(o=>o.nodeType===Node.ELEMENT_NODE);if(n.length>1)throw new Error(`XML contains ${n.length} root nodes, but only 1 is allowed`)}function M(s){return s?s.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:text\/html/gi,"").replace(/expression\s*\(/gi,"").trim():""}function Ie(s,e){if(!s)return"";const r=s.querySelector(e)?.textContent||"";return M(r)}function De(s,e){if(!s)return"";const t=s.getAttribute(e)||"";return M(t)}function Re(s,e=Y){try{if(!s||typeof s!="string")throw new Error("Invalid XML input: must be a non-empty string");const t=s.trim();if(!t)throw new Error("Invalid XML input: must be a non-empty string");Z(t,e);const n=new DOMParser().parseFromString(t,"application/xml"),o=n.querySelector("parsererror");if(o)throw new Error(`XML parsing error: ${o.textContent}`);return Fe(n,e),n}catch(t){throw console.error("Secure XML parsing error:",t),new Error(`Failed to parse XML securely: ${t instanceof Error?t.message:"Unknown error"}`)}}function Ae(s){const e={...Y,allowedRootElements:["rss","feed","rdf:rdf","rdf"]};return Re(s,e)}const $e={getSecureTextContent:Ie,getSecureAttributeValue:De,sanitizeTextContent:M,validateXmlSecurity:Z},Ne=[{original:"http://feeds.feedburner.com/tecnoblog",alternatives:["https://tecnoblog.net/feed/","https://tecnoblog.net/rss/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/Techcrunch",alternatives:["https://techcrunch.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/blogdoiphone/rss",alternatives:["https://blogdoiphone.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://macmagazine.com.br/feed/",alternatives:["https://macmagazine.com.br/feed/"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds2.feedburner.com/canaltechbr",alternatives:["https://canaltech.com.br/rss/","https://canaltech.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/guiadopc",alternatives:["https://guiadopc.com.br/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://meiobit.com/index.xml",alternatives:["https://meiobit.com/feed/","https://meiobit.com/index.xml"],notes:"HTTP to HTTPS redirect"},{original:"http://feeds.feedburner.com/design-milk",alternatives:["https://design-milk.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/core77/blog",alternatives:["https://www.core77.com/rss/object.xml"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/dezeen",alternatives:["https://www.dezeen.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/JustCreativeDesignBlog",alternatives:["https://justcreative.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds2.feedburner.com/thenextweb",alternatives:["https://thenextweb.com/feed/"],notes:"FeedBurner redirect to direct feed"},{original:"http://feeds.feedburner.com/brainstorm9",alternatives:["https://www.brainstorm9.com/feed/"],notes:"FeedBurner redirect to direct feed"}];function Me(s){const e=[s],t=Ne.find(r=>r.original===s);if(t&&e.push(...t.alternatives),s.startsWith("http://")){const r=s.replace("http://","https://");e.includes(r)||e.push(r)}return[...new Set(e)]}const Pe=8e3,ze=2,Le=500,y=w(),Ue=[{name:"RSS2JSON",url:"https://api.rss2json.com/v1/api.json",format:s=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(s)}`,parser:Oe},{name:"AllOrigins",url:"https://api.allorigins.win/raw",format:s=>`https://api.allorigins.win/raw?url=${encodeURIComponent(s)}`,parser:A},{name:"CodeTabs",url:"https://api.codetabs.com/v1/proxy",format:s=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(s)}`,parser:A},{name:"CORSProxy",url:"https://corsproxy.io",format:s=>`https://corsproxy.io/?${encodeURIComponent(s)}`,parser:A}];class ke{constructor(){this.failures=new Map,this.threshold=3,this.timeout=6e4}isOpen(e){const t=this.failures.get(e);return t?Date.now()-t.lastAttempt>this.timeout?(this.failures.delete(e),!1):t.count>=this.threshold:!1}recordFailure(e){const t=this.failures.get(e)||{count:0,lastAttempt:0};t.count++,t.lastAttempt=Date.now(),this.failures.set(e,t)}recordSuccess(e){this.failures.delete(e)}}const $=new ke;function Q(s){return $e.sanitizeTextContent(s)}async function Be(s,e={}){const{timeout:t=Pe,...r}=e,n=new AbortController,o=setTimeout(()=>n.abort(),t);try{const a=await fetch(s,{...r,signal:n.signal,headers:{Accept:"application/rss+xml, application/xml, application/atom+xml, text/xml, application/json, */*",...r.headers}});return clearTimeout(o),a}catch(a){throw clearTimeout(o),a instanceof Error&&a.name==="AbortError"?new Error(`Request timeout after ${t}ms`):a}}function Oe(s,e){const t=JSON.parse(s);if(t.status==="error")throw new Error(`RSS2JSON error: ${t.message||"Unknown error"}`);if(t.status!=="ok"||!t.items)throw new Error("Invalid RSS2JSON response format");const r=t.items.map(n=>{let o=n.thumbnail||n.enclosure?.link;if(o)try{new URL(o).protocol.startsWith("http")||(o=void 0),o&&(o.includes("?text=")||o.match(/^[A-Z0-9]{6}\?text=/i)||!o.includes("."))&&(o=void 0)}catch{o=void 0}return{title:n.title||"No Title",link:n.link||e,pubDate:n.pubDate?new Date(n.pubDate):new Date,description:n.description?Q(n.description).substring(0,200):"",sourceTitle:t.feed?.title||"RSS Feed",author:n.author||void 0,categories:n.categories||[],imageUrl:o||void 0}});return{title:t.feed?.title||"RSS Feed",articles:r}}function A(s,e){const t=Ae(s),r=t.getElementsByTagName("parsererror");if(r.length>0)throw new Error(`XML parsing error: ${r[0].textContent}`);let n="Untitled Feed",o;const a=t.getElementsByTagName("channel");if(a.length>0)n=a[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",o=t.getElementsByTagName("item");else{const h=t.getElementsByTagName("feed");if(h.length>0)n=h[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed",o=t.getElementsByTagName("entry");else{const c=t.getElementsByTagName("item");if(c.length>0){const m=t.getElementsByTagName("channel");m.length>0&&(n=m[0].getElementsByTagName("title")[0]?.textContent?.trim()||"Untitled Feed"),o=c}else throw new Error("Unsupported RSS format")}}const i=[];for(let h=0;h<Math.min(o.length,50);h++){const c=o[h];try{const f=c.getElementsByTagName("title")[0]?.textContent?.trim()||"No Title";let b="";const E=c.getElementsByTagName("link");E.length>0&&(b=E[0].textContent?.trim()||E[0].getAttribute("href")||"");let P=new Date;const te=c.getElementsByTagName("pubDate"),se=c.getElementsByTagName("published"),re=c.getElementsByTagName("date"),z=te[0]||se[0]||re[0];if(z?.textContent){const d=new Date(z.textContent.trim());isNaN(d.getTime())||(P=d)}let L="";const ne=c.getElementsByTagName("description"),oe=c.getElementsByTagName("summary"),ae=c.getElementsByTagName("content"),T=ne[0]||oe[0]||ae[0];T?.textContent&&(L=Q(T.textContent).substring(0,200));let U="";const ie=c.getElementsByTagName("author"),ce=c.getElementsByTagName("creator"),k=ie[0]||ce[0];k?.textContent&&(U=k.textContent.trim());const B=[],O=c.getElementsByTagName("category");for(let d=0;d<O.length;d++){const p=O[d].textContent?.trim();p&&B.push(p)}let g="";const W=c.getElementsByTagName("enclosure");for(let d=0;d<W.length;d++){const p=W[d],S=p.getAttribute("type");if(S&&S.startsWith("image/")){g=p.getAttribute("url")||"";break}}if(!g){const d=c.getElementsByTagName("media:content");for(let p=0;p<d.length;p++){const S=d[p],v=S.getAttribute("type");if(v&&v.startsWith("image/")){g=S.getAttribute("url")||"";break}}}if(!g){const d=c.getElementsByTagName("media:thumbnail");d.length>0&&(g=d[0].getAttribute("url")||"")}if(!g&&T){const d=T.innerHTML||T.textContent||"",p=[/<img[^>]+src=["']([^"']+)["'][^>]*>/i,/src=["']([^"']+\.(?:jpg|jpeg|png|gif|webp|svg))[^"']*/i,/https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|svg)/i];for(const S of p){const v=d.match(S);if(v&&v[1]){g=v[1];break}}}let _;if(g)try{const d=new URL(g);(d.protocol==="http:"||d.protocol==="https:")&&!g.includes("?text=")&&!g.match(/^[A-Z0-9]{6}\?text=/i)&&g.includes(".")&&(_=g)}catch{y.debug(`Invalid image URL filtered: ${g}`,{component:"rssParser"})}f!=="No Title"&&b&&i.push({title:f,link:b,pubDate:P,description:L,imageUrl:_,author:U||void 0,categories:B,sourceTitle:n})}catch(m){y.warn(`Failed to parse article ${h+1}`,{component:"rssParser",additionalData:{error:m instanceof Error?m.message:String(m)}})}}return{title:n,articles:i}}function We(s){if(!s||s.trim().length===0)return!1;const e=s.trim();return e.toLowerCase().includes("<!doctype html")||e.toLowerCase().startsWith("<html")?!1:e.startsWith("<")||e.startsWith("{")}async function _e(s,e,t){if($.isOpen(s.name))throw new Error(`Circuit breaker open for ${s.name}`);const r=s.format(e);y.debug(`Trying provider: ${s.name}`,{component:"rssParser",additionalData:{feedUrl:e,proxyUrl:r}});const n=await Be(r,{signal:t});if(!n.ok)throw n.status===422?new Error(`Provider ${s.name} cannot process this feed (422 Unprocessable Entity)`):new Error(`Provider ${s.name} returned ${n.status}: ${n.statusText}`);const o=await n.text();if(!We(o))throw new Error(`Invalid response from ${s.name}`);const a=s.parser(o,e);if(!a.articles||a.articles.length===0)throw new Error(`No articles parsed from ${s.name}`);return $.recordSuccess(s.name),y.info(`Successfully fetched via ${s.name}`,{component:"rssParser",additionalData:{feedUrl:e,provider:s.name,articlesCount:a.articles.length}}),a}async function je(s,e){const t=Me(s);let r=new Error("Unknown error");for(const n of t)for(const o of Ue)try{return await _e(o,n,e)}catch(a){r=a instanceof Error?a:new Error(String(a)),$.recordFailure(o.name),y.debug(`Provider ${o.name} failed for ${n}`,{component:"rssParser",additionalData:{error:r.message}})}throw new Error(`All providers failed. Last error: ${r.message}`)}function Xe(s){return new Promise(e=>setTimeout(e,s))}async function Ge(s,e={}){const{maxRetries:t=ze,signal:r}=e;let n=new Error("Unknown error");for(let o=1;o<=t;o++)try{y.debug(`Fetching feed (attempt ${o}/${t})`,{component:"rssParser",additionalData:{feedUrl:s}});const a=await je(s,r);return a.articles.length>0&&Ce(s,a.articles,a.title),y.info(`Successfully fetched feed on attempt ${o}`,{component:"rssParser",additionalData:{feedUrl:s,articlesCount:a.articles.length,attempt:o}}),a}catch(a){if(n=a instanceof Error?a:new Error(String(a)),r?.aborted)throw new Error("Request was cancelled");if(o===t)break;const i=Le*Math.pow(2,o-1);y.warn(`Attempt ${o} failed, retrying in ${i}ms`,{component:"rssParser",additionalData:{feedUrl:s,error:n.message}}),await Xe(i)}throw y.error(`All ${t} attempts failed`,n,{component:"rssParser",additionalData:{feedUrl:s}}),n}async function st(s,e={}){const{skipCache:t=!1}=e;if(!t){const r=Te(s);if(r&&r.length>0)return y.debug("Using cached articles",{component:"rssParser",additionalData:{feedUrl:s,cachedCount:r.length}}),{title:r[0].sourceTitle,articles:r}}try{return await Ge(s,e)}catch(r){return y.warn("Creating placeholder for failed feed",{component:"rssParser",additionalData:{url:s,error:r instanceof Error?r.message:String(r)}}),{title:"Feed Unavailable",articles:[{title:"RSS Feed Temporarily Unavailable",link:s,pubDate:new Date,description:"Unable to fetch this RSS feed. This may be due to CORS restrictions or temporary server issues. The feed will be retried automatically.",sourceTitle:"System Notice",categories:["system","unavailable"]}]}}}function rt(s){const r=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("outline"),n=[];for(let o=0;o<r.length;o++){const i=r[o].getAttribute("xmlUrl");i&&n.push(i)}return n}const l=s=>{const e=s.replace("#","");if(!/^[a-fA-F0-9]{3}$|^[a-fA-F0-9]{6}$/.test(e))throw new Error(`Invalid hex color format: ${s}. Expected format: #RRGGBB or #RGB`);let t,r,n;if(e.length===3?(t=parseInt(e[0]+e[0],16),r=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16)):(t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16)),isNaN(t)||isNaN(r)||isNaN(n)||t<0||t>255||r<0||r>255||n<0||n>255)throw new Error(`Invalid hex color conversion result: ${s} -> ${t} ${r} ${n}`);return`${t} ${r} ${n}`},D=[{id:"noite-urbana",name:"Noite Urbana",description:"Tema escuro urbano com azul médio e acentos âmbar",category:"dark",theme:{id:"noite-urbana",name:"Noite Urbana",colors:{primary:"18 102 204",secondary:l("#1E1E1E"),accent:"138 101 8",background:l("#121212"),surface:l("#1E1E1E"),text:l("#FFFFFF"),textSecondary:l("#B0B0B0"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verde-noturno",name:"Verde Noturno",description:"Tema escuro com verde natural e acentos solares",category:"dark",theme:{id:"verde-noturno",name:"Verde Noturno",colors:{primary:"52 125 54",secondary:l("#1B1F1D"),accent:"122 105 17",background:l("#0D0D0D"),surface:l("#1B1F1D"),text:l("#F1F1F1"),textSecondary:l("#A8A8A8"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"roxo-nebuloso",name:"Roxo Nebuloso",description:"Tema escuro místico com roxo vibrante e rosa neon",category:"dark",theme:{id:"roxo-nebuloso",name:"Roxo Nebuloso",colors:{primary:"173 46 207",secondary:l("#1A1A23"),accent:"204 51 102",background:l("#101014"),surface:l("#1A1A23"),text:l("#E0E0E0"),textSecondary:l("#9C9C9C"),border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"solar-clean",name:"Solar Clean",description:"Tema claro limpo com azul clássico e laranja queimado",category:"light",theme:{id:"solar-clean",name:"Solar Clean",colors:{primary:l("#1976D2"),secondary:l("#F5F5F5"),accent:"184 61 23",background:l("#FFFFFF"),surface:l("#F5F5F5"),text:l("#212121"),textSecondary:l("#616161"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"verao-pastel",name:"Verão Pastel",description:"Tema claro pastel com rosa vibrante e lilás suave",category:"light",theme:{id:"verao-pastel",name:"Verão Pastel",colors:{primary:"178 48 92",secondary:l("#FFFFFF"),accent:l("#7E57C2"),background:l("#FFF8F0"),surface:l("#FFFFFF"),text:l("#212121"),textSecondary:"97 97 97",border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"minimal-ice",name:"Minimal Ice",description:"Tema claro minimalista com ciano frio e coral quente",category:"light",theme:{id:"minimal-ice",name:"Minimal Ice",colors:{primary:"0 129 145",secondary:l("#FFFFFF"),accent:"184 81 49",background:l("#F0F4F8"),surface:l("#FFFFFF"),text:l("#1C1C1C"),textSecondary:l("#5E5E5E"),border:"156 163 175",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],nt={currentTheme:D.find(s=>s.id==="solar-clean")?.theme||D[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},ee=s=>{const e=["id","name","colors","layout","density","borderRadius"],t=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const r of e)if(!(r in s))return console.warn(`Theme validation failed: missing field "${r}"`),!1;if(s.colors){for(const r of t)if(!(r in s.colors))return console.warn(`Theme validation failed: missing color "${r}"`),!1}if(s.colors){for(const[r,n]of Object.entries(s.colors))if(!Je(n))return console.warn(`Theme validation failed: invalid RGB format for color "${r}": "${n}"`),!1}return!0},Je=s=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(s)?s.split(/\s+/).map(Number).every(r=>r>=0&&r<=255):!1,ot=(s,e="1.0")=>{try{if(typeof s=="string")return J(s,"Migrated Theme");if(ee(s))return s;if(s.colors?.accent||s.accent){const t=s.colors?.accent||s.accent;return J(t,s.name||"Migrated Theme")}return null}catch(t){return console.error("Theme migration failed:",t),null}},J=(s,e)=>{const t=s.split(/\s+/).map(Number),[r,n,o]=t,a=r*.299+n*.587+o*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:s,secondary:a?"45 55 72":"229 231 235",accent:s,background:a?"26 32 44":"255 255 255",surface:a?"45 55 72":"249 250 251",text:a?"247 250 252":"17 24 39",textSecondary:a?"160 174 192":"107 114 128",border:a?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},at=s=>{const e=document.documentElement;Object.entries(s.colors).forEach(([i,h])=>{e.style.setProperty(`--color-${i}`,h)});const r={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[s.layout];e.style.setProperty("--layout-padding",r.padding),e.style.setProperty("--layout-gap",r.gap);const o={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[s.density];e.style.setProperty("--density-font-size",o.fontSize),e.style.setProperty("--density-line-height",o.lineHeight);const a={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",a[s.borderRadius]),e.style.setProperty("--shadows-enabled",s.shadows?"1":"0"),e.style.setProperty("--animations-enabled",s.animations?"1":"0"),e.style.setProperty("--transition-duration",s.animations?"0.2s":"0s")},it=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",ct=s=>{const e=D.filter(t=>t.category===s||s==="dark"&&t.category==="colorful");return e.length>0?e[0].theme:D[0].theme},lt=s=>JSON.stringify(s,null,2),ht=s=>{try{const e=JSON.parse(s);return ee(e)?e:null}catch(e){return console.error("Failed to import theme:",e),null}};export{et as a,He as b,Qe as c,nt as d,it as e,ct as f,Ze as g,qe as h,at as i,D as j,l as k,lt as l,ot as m,ht as n,Te as o,rt as p,st as q,tt as r,Ve as s,we as t,Ye as u,ee as v};
